//
//  CustomPopListView.m
//  Sandglass
//
//  Created by kangqijun on 13-11-5.
//
//

#import "CustomPopListView.h"

@implementation CustomPopListView

@synthesize m_delegate;

- (id)initWithFrame:(CGRect)frame
{
    self = [super initWithFrame:frame];
    if (self)
    {
        //全屏背景按钮
        UIButton *bgButton = [UIButton buttonWithType:UIButtonTypeCustom];
        [bgButton addTarget:self action:@selector(closePopListView) forControlEvents:UIControlEventTouchDown];
        [bgButton setFrame:CGRectMake(0, 0, frame.size.width, frame.size.height)];
        [self addSubview:bgButton];
    }
    return self;
}

- (void)loadContentViewWith:(UIView *)_view withPosionView:(UIView *)_pView
{
    //将弹出视图加载全屏大小的底层视图上(加在window上，旋转屏幕会有问题)
    NSArray *windows = [UIApplication sharedApplication].windows;
    UIWindow *window = [windows objectAtIndex:0];
    [window.rootViewController.view addSubview:self];
    
    //计算内容视图的位置
    CGPoint point = [_pView.superview convertPoint:_pView.center toView:window.rootViewController.view];
    
    CGRect rect = _view.frame;
    rect.origin.x = point.x - rect.size.width/2;
    rect.origin.y = point.y + _pView.frame.size.height/2;
    _view.frame = rect;
    
    _view.alpha = 0;
    [self addSubview:_view];
    
    //淡入淡出动画
    [UIView animateWithDuration:0.3 animations:^{
        _view.alpha = 1;
        
    }];
}

- (void)loadDatePickerViewWith:(UIView *)_view withPosionView:(UIView *)_pView
{
    //将弹出视图加载全屏大小的底层视图上(加在window上，旋转屏幕会有问题)
    NSArray *windows = [UIApplication sharedApplication].windows;
    UIWindow *window = [windows objectAtIndex:0];
    [window.rootViewController.view addSubview:self];
    
    //计算内容视图的位置
    CGPoint point = window.rootViewController.view.center;
    CGRect rect = _view.frame;
    rect.origin.x = point.y - rect.size.width/2;
    rect.origin.y = point.x - rect.size.height/2;
    _view.frame = rect;
    
    _view.alpha = 0;
    [self addSubview:_view];
    
    //淡入淡出动画
    [UIView animateWithDuration:0.3 animations:^{
        _view.alpha = 1;
        
    }];
}

- (void)closePopListView
{
    //淡入淡出动画
    [UIView animateWithDuration:0.3 animations:^{
        self.alpha = 0;
    } completion:^(BOOL finished) {
        [self removeFromSuperview];
        
        if (m_delegate)
        {
            [m_delegate removePopListView];
        }
    }];
}

@end
