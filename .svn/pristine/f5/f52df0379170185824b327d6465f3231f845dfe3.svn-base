/********************************************************************
 Author: li_xiangai
 Class description:NdUncaughtExceptionHandle
 *******************************************************/

#import "NdUncaughtExceptionHandle.h"

@implementation NdUncaughtExceptionHandle


/*********************************************************************
 Function description:Documents文件路径
 Parameter: &UncaughtExceptionHandler  函数指针
 Return value: N/A
 Author: li_xiangai
 Remark: override
 *********************************************************************/
NSString *applicationDocumentsDirectory()
{
    return [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) lastObject];
}

/*********************************************************************
 Function description:设置异常回调处理函数
 Parameter: &UncaughtExceptionHandler   函数指针
 Return value: N/A
 Author: li_xiangai
 Remark: override
 *********************************************************************/
+ (void)setDefaultHandler
{
    NSSetUncaughtExceptionHandler (&UncaughtExceptionHandler);
}

/*********************************************************************
 Function description:获取异常回调对象
 Parameter: N/A
 Return value: NSUncaughtExceptionHandler对象
 Author: li_xiangai
 Remark: override
 *********************************************************************/

+ (NSUncaughtExceptionHandler*)getHandler
{
    return NSGetUncaughtExceptionHandler();
}

/*********************************************************************
 Function description:异常处理方法
 Parameter: exception 异常对象
 Return value: N/A
 Author: li_xiangai
 Remark: override
 *********************************************************************/

void UncaughtExceptionHandler(NSException *exception)
{
    NSArray *arr = [exception callStackSymbols];
    NSString *reason = [exception reason];
    NSString *name = [exception name];
    
    NSString *url = [NSString stringWithFormat:@"=============异常崩溃报告=============\time:\n%@ nname:\n%@\nreason:\n%@\ncallStackSymbols:\n%@",
               [[NSDate date] description], name,reason,[arr componentsJoinedByString:@"\n"]];
    
    NSLog(@"url------>%@",url);
    NSString *path = [applicationDocumentsDirectory() stringByAppendingPathComponent:@"Exception.txt"];
    [url writeToFile:path atomically:YES encoding:NSUTF8StringEncoding error:nil];

}

@end
