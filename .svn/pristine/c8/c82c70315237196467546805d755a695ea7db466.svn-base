/********************************************************************
 Author: li_xiangai
 Class description:GPSLocation
 *******************************************************/
#import "GPSLocation.h"
static CLLocationManager *locationManager = nil;
static id<GPSLocationDelegate> callbackDelegate = nil;
@implementation GPSLocation
/*********************************************************************
 Function description:开始GPS定位
 Parameter: delegate
 Return value: N/A
 Author: li_xiangai
 Remark: override
 *********************************************************************/
+(void)location:(id)delegate 
{
    callbackDelegate = delegate;
    if (!locationManager)
    {
       locationManager =[[CLLocationManager alloc]init];  
    }
    locationManager.delegate = (id)self;
    locationManager.desiredAccuracy = kCLLocationAccuracyBest;
    locationManager.distanceFilter = 5.0f;
    [locationManager startUpdatingLocation];

}

/*********************************************************************
 Function description:GPS定位失败
 Parameter: manager，error
 Return value: N/A
 Author: li_xiangai
 Remark: override
 *********************************************************************/
+(void)locationManager:(CLLocationManager *)manager didFailWithError:(NSError *)error
{
  
    [locationManager stopUpdatingLocation];
    [locationManager release];
    locationManager = nil;

    NSLog(@"error-->%@",[error description]);
    
    //GPS定位失败
    if (callbackDelegate && [callbackDelegate respondsToSelector:@selector(locationWithError:)])
    {
        [callbackDelegate locationWithError:error];
    }
    callbackDelegate = nil;
    
}
/*********************************************************************
 Function description:GPS定位成功
 Parameter: manager,newLocation,oldLocation
 Return value: N/A
 Author: li_xiangai
 Remark: override
 *********************************************************************/
+(void)locationManager:(CLLocationManager *)manager didUpdateToLocation:(CLLocation *)newLocation fromLocation:(CLLocation *)oldLocation
{
    //GPS定位成功，传回经纬度
    
     CGPoint point = CGPointMake(newLocation.coordinate.longitude, newLocation.coordinate.latitude);
    [locationManager stopUpdatingLocation];
    [locationManager release];
    locationManager = nil;
    
    if (callbackDelegate && [callbackDelegate respondsToSelector:@selector(locationPoint:)])
    {
        [callbackDelegate locationPoint:point];
    }
    //callbackDelegate = nil;
}

@end
